<!DOCTYPE html> 
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chinese Character Writing Practicing</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background-color: #f9f9f9;
    margin: 0;
    padding: 0;
  }
  #character {
    margin: 10px auto;
    width: 40vw;
    height: 40vw;
    max-width: 150px;
    max-height: 150px;
    border: 1px solid #ccc;
    background-color: white;
  }
  .practice-box {
    width: 40vw;
    height: 40vw;
    max-width: 150px;
    max-height: 150px;
    border: 1px solid #ccc;
    background-color: white;
    margin: 5px;
  }
  #practiceContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: 100%;
  }
  .word-list {
    margin-top: 20px;
    list-style-type: none;
    padding: 0;
    text-align: left;
    display: inline-block;
  }
  .word-list li {
    margin: 4px 0;
    font-size: 4vw;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .word-chinese {
    font-family: "KaiTi", "Ê•∑‰Ωì", serif;
    font-weight: bold;
    font-size: 6vw;
    margin-right: 6px;
  }
  select, button {
    padding: 5px;
    font-size: 4vw;
    margin: 5px;
  }
  h3.common-title {
    display: inline-block;
    border: 1px solid #ccc;
    padding: 2px 6px;
    margin-top: 10px;
    font-size: 4vw;
  }
  #charAudioContainer {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
  }
  #charAudioContainer h2 {
    font-size: 7vw;
    margin: 0;
  }
  #charAudioContainer button {
    font-size: 5vw;
    padding: 5px 10px;
  }
</style>
<script src="https://unpkg.com/hanzi-writer/dist/hanzi-writer.min.js"></script>
</head>
<body>

<h1>Chinese Character Writing Practicing</h1>

<p>select a category:</p>
<select id="lessonSelect"></select>
<br>
<p>Select a Chinese character:</p>
<select id="charSelect"></select>
<br>

<div id="charAudioContainer">
  <h2 id="charInfo"></h2>
  <button id="playAudio">üîä</button>
</div>

<div id="wordList" class="word-list"></div><br>

<p style="font-size:11px;">&nbsp;&nbsp;&nbsp;&nbsp;*The pronunciation of the words on this page is for reference only. It is recommended that you go to more professional websites or learn the pronunciation from your Chinese teacher.&nbsp;&nbsp;&nbsp;&nbsp;</p>

<div id="character"></div>

<p>Have a practiceÔºö‚úçÔ∏è</p>
<div id="practiceContainer"></div>

<br><br>

<script>
const SHEET_URL = "https://opensheet.vercel.app/1OhIY2yvP9_K4SsIk0yTDi-0-vOof99hoXYclf8lt_CY/Â∑•‰ΩúË°®1";

let charData = {};   // Êåâ Lesson Â≠òÂÇ®: charData[lesson] = { character: {pinyin, english, words} }
let lessonOrder = [];
let currentLesson = "";
let currentChars = [];
let currentChar = "";
let writer;

// Âä†ËΩΩÊï∞ÊçÆ
fetch(SHEET_URL)
  .then(res => res.json())
  .then(data => {
    data.forEach(row => {
      if (!charData[row.lesson]) charData[row.lesson] = {};
      charData[row.lesson][row.character] = {
        pinyin: row.pinyin,
        english: row.english,
        words: [
          { word: row.word1, pinyin: row.word1_pinyin, english: row.word1_english },
          { word: row.word2, pinyin: row.word2_pinyin, english: row.word2_english }
        ]
      };
    });
    lessonOrder = Object.keys(charData);
    initLessonSelect();
    loadLesson(lessonOrder[0]);
  });

// ÂàùÂßãÂåñ Lesson ‰∏ãÊãâ
function initLessonSelect() {
  const select = document.getElementById("lessonSelect");
  select.innerHTML = "";
  lessonOrder.forEach(lesson => {
    const opt = document.createElement("option");
    opt.value = lesson;
    opt.textContent = lesson;
    select.appendChild(opt);
  });
  select.addEventListener("change", () => loadLesson(select.value));
}

// Âä†ËΩΩÊåáÂÆö Lesson
function loadLesson(lesson) {
  currentLesson = lesson;
  currentChars = Object.keys(charData[lesson]);
  initCharSelect();
  loadCharacter(0);
}

// ÂàùÂßãÂåñ Character ‰∏ãÊãâ
function initCharSelect() {
  const select = document.getElementById("charSelect");
  select.innerHTML = "";
  currentChars.forEach((char, index) => {
    const opt = document.createElement("option");
    opt.value = index;
    opt.textContent = char;
    select.appendChild(opt);
  });
  select.addEventListener("change", () => {
    loadCharacter(parseInt(select.value));
  });
}

// Âä†ËΩΩÊåáÂÆöÊ±âÂ≠ó
function loadCharacter(index) {
  currentChar = currentChars[index];
  const info = charData[currentLesson][currentChar];

  document.getElementById("charInfo").textContent = `${currentChar} (${info.pinyin}) - ${info.english}`;
  document.getElementById("charSelect").value = index;

  // ÊòæÁ§∫ËØçÂàóË°®
  const wordList = document.getElementById("wordList");
  wordList.innerHTML = "";
  info.words.forEach(w => {
    if (w.word) {
      const li = document.createElement("li");
      li.innerHTML = `<span class="word-chinese">${w.word}</span> (${w.pinyin}) - ${w.english}`;

      const playBtn = document.createElement("button");
      playBtn.textContent = "üîä";
      playBtn.style.fontSize = "4vw";
      playBtn.addEventListener("click", () => {
        const utter = new SpeechSynthesisUtterance(w.word);
        utter.lang = "zh-CN";
        speechSynthesis.speak(utter);
      });

      li.appendChild(playBtn);
      wordList.appendChild(li);
    }
  });

  renderCharacterAndPractice(currentChar);
}

// Ê∏≤ÊüìÊ±âÂ≠óÂíåÁªÉ‰π†Âå∫
function renderCharacterAndPractice(text) {
  document.getElementById("character").innerHTML = "";
  const size = Math.min(window.innerWidth * 0.4, 150);
  writer = HanziWriter.create('character', text, { width: size, height: size, padding: 5, showOutline: true });
  writer.loopCharacterAnimation();

  const container = document.getElementById("practiceContainer");
  container.innerHTML = "";
  for (let i = 0; i < 8; i++) {
    const div = document.createElement("div");
    div.className = "practice-box";
    container.appendChild(div);
    const practiceWriter = HanziWriter.create(div, text, {
      width: size,
      height: size,
      padding: 8,
      showOutline: true,
      showCharacter: false
    });
    practiceWriter.quiz();
  }
}

// Êí≠ÊîæÂΩìÂâçÊ±âÂ≠óÂ£∞Èü≥
document.getElementById("playAudio").addEventListener("click", () => {
  const utter = new SpeechSynthesisUtterance(currentChar);
  utter.lang = "zh-CN";
  speechSynthesis.speak(utter);
});
</script>

</body>
</html>
